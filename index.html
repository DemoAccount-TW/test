<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äººæ¬Šå®ˆè­·è€… - äº’å‹•æ•™è‚²æ¡ŒéŠ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
        }

        .game-container {
            max-width: 1200px;
            width: 100%;
            padding: 20px;
        }

        .game-header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .game-title {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .game-subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .game-board {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .main-board {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .side-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .panel-section {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .world-map {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .region {
            aspect-ratio: 1;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8em;
            text-align: center;
            position: relative;
            border: 2px solid rgba(255,255,255,0.3);
        }

        .region:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .region.safe { background: linear-gradient(135deg, #4CAF50, #45a049); }
        .region.threatened { background: linear-gradient(135deg, #FF9800, #f57c00); }
        .region.crisis { background: linear-gradient(135deg, #f44336, #d32f2f); }
        .region.recovering { background: linear-gradient(135deg, #2196F3, #1976d2); }

        .crisis-indicator {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 15px;
            height: 15px;
            background: #ff4444;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        .action-cards {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .action-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 150px;
            text-align: center;
        }

        .action-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            border-color: #FFD700;
        }

        .action-card.selected {
            border-color: #FFD700;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #333;
        }

        .game-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .event-log {
            max-height: 200px;
            overflow-y: auto;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 10px;
            font-size: 0.9em;
        }

        .event-item {
            margin-bottom: 8px;
            padding: 5px;
            border-left: 3px solid #FFD700;
            padding-left: 10px;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
            font-weight: bold;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            border-color: #FFD700;
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.primary {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #333;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: rgba(255,255,255,0.95);
            color: #333;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .modal-title {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: #667eea;
        }

        .human-rights-list {
            text-align: left;
            margin: 15px 0;
            padding: 15px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 8px;
        }

        .human-rights-list li {
            margin-bottom: 8px;
        }

        @media (max-width: 768px) {
            .game-board {
                grid-template-columns: 1fr;
            }
            
            .world-map {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .game-title {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1 class="game-title">äººæ¬Šå®ˆè­·è€…</h1>
            <p class="game-subtitle">Human Rights Defenders - åˆä½œå¼äººæ¬Šæ•™è‚²æ¡ŒéŠ</p>
        </div>

        <div class="game-board">
            <div class="main-board">
                <h3 style="margin-bottom: 15px; text-align: center;">ğŸŒ ä¸–ç•Œäººæ¬Šç‹€æ³åœ°åœ–</h3>
                <div class="world-map" id="worldMap">
                    <!-- åœ°å€å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                </div>
                
                <h4 style="margin-bottom: 10px;">ğŸ¯ å¯åŸ·è¡Œè¡Œå‹•</h4>
                <div class="action-cards" id="actionCards">
                    <!-- è¡Œå‹•å¡ç‰‡å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>

            <div class="side-panel">
                <div class="panel-section">
                    <h4 style="margin-bottom: 15px;">ğŸ“Š éŠæˆ²ç‹€æ…‹</h4>
                    <div class="game-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="humanityScore">85</div>
                            <div>äººé“æŒ‡æ•¸</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="resourcePoints">12</div>
                            <div>è¡Œå‹•é»æ•¸</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="crisisCount">3</div>
                            <div>å±æ©Ÿæ•¸é‡</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="turnNumber">1</div>
                            <div>å›åˆæ•¸</div>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressBar" style="width: 85%"></div>
                    </div>
                    <p style="text-align: center; margin-top: 10px; font-size: 0.9em;">ç›®æ¨™ï¼šé”åˆ°90%äººé“æŒ‡æ•¸</p>
                </div>

                <div class="panel-section">
                    <h4 style="margin-bottom: 10px;">ğŸ“° äº‹ä»¶ç´€éŒ„</h4>
                    <div class="event-log" id="eventLog">
                        <div class="event-item">éŠæˆ²é–‹å§‹ï¼ç›®æ¨™æ˜¯æå‡å…¨çƒäººæ¬Šç‹€æ³ã€‚</div>
                    </div>
                </div>

                <div class="panel-section">
                    <h4 style="margin-bottom: 10px;">ğŸ² éŠæˆ²èªªæ˜</h4>
                    <p style="font-size: 0.9em; line-height: 1.4;">
                        é¸æ“‡åœ°å€å’Œè¡Œå‹•å¡ä¾†æ”¹å–„äººæ¬Šç‹€æ³ã€‚ä¸åŒè¡Œå‹•æœ‰ä¸åŒæ•ˆæœå’Œæˆæœ¬ã€‚åˆä½œé”æˆ90%äººé“æŒ‡æ•¸ï¼
                    </p>
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="btn" onclick="showRules()">ğŸ“‹ éŠæˆ²è¦å‰‡</button>
            <button class="btn" onclick="showHumanRights()">ğŸ“œ äººæ¬ŠçŸ¥è­˜</button>
            <button class="btn primary" onclick="executeAction()" id="executeBtn" disabled>åŸ·è¡Œè¡Œå‹•</button>
            <button class="btn" onclick="nextTurn()">â­ï¸ ä¸‹ä¸€å›åˆ</button>
            <button class="btn" onclick="resetGame()">ğŸ”„ é‡æ–°é–‹å§‹</button>
        </div>
    </div>

    <!-- éŠæˆ²è¦å‰‡å½ˆçª— -->
    <div class="modal" id="rulesModal">
        <div class="modal-content">
            <h3 class="modal-title">ğŸ¯ éŠæˆ²è¦å‰‡</h3>
            <div style="text-align: left;">
                <h4>ç›®æ¨™ï¼š</h4>
                <p>åœ¨15å›åˆå…§å°‡å…¨çƒäººé“æŒ‡æ•¸æå‡è‡³90%ä»¥ä¸Š</p>
                
                <h4>éŠæˆ²æµç¨‹ï¼š</h4>
                <ol>
                    <li>è§€å¯Ÿå„åœ°å€äººæ¬Šç‹€æ³ï¼ˆå®‰å…¨/å¨è„…/å±æ©Ÿ/æ¢å¾©ä¸­ï¼‰</li>
                    <li>é¸æ“‡ç›®æ¨™åœ°å€</li>
                    <li>é¸æ“‡é©ç•¶çš„è¡Œå‹•å¡</li>
                    <li>åŸ·è¡Œè¡Œå‹•ï¼ˆæ¶ˆè€—è¡Œå‹•é»æ•¸ï¼‰</li>
                    <li>è§€å¯Ÿçµæœå’Œæ–°äº‹ä»¶</li>
                </ol>
                
                <h4>è¡Œå‹•é¡å‹ï¼š</h4>
                <ul>
                    <li><strong>æ•™è‚²å®£å°ï¼š</strong>æå‡æ„è­˜ï¼Œé é˜²å•é¡Œ</li>
                    <li><strong>æ³•å¾‹æ´åŠ©ï¼š</strong>ä¿è­·å—å®³è€…æ¬Šç›Š</li>
                    <li><strong>åª’é«”é—œæ³¨ï¼š</strong>å¢åŠ åœ‹éš›å£“åŠ›</li>
                    <li><strong>äººé“æ•‘æ´ï¼š</strong>ç·Šæ€¥å±æ©Ÿè™•ç†</li>
                    <li><strong>æ”¿ç­–å€¡è­°ï¼š</strong>æ¨å‹•åˆ¶åº¦æ”¹é©</li>
                </ul>
            </div>
            <br>
            <button class="btn primary" onclick="closeModal('rulesModal')">äº†è§£äº†</button>
        </div>
    </div>

    <!-- äººæ¬ŠçŸ¥è­˜å½ˆçª— -->
    <div class="modal" id="humanRightsModal">
        <div class="modal-content">
            <h3 class="modal-title">ğŸ“œ åŸºæœ¬äººæ¬ŠçŸ¥è­˜</h3>
            <div class="human-rights-list">
                <h4>è¯åˆåœ‹ä¸–ç•Œäººæ¬Šå®£è¨€ - åŸºæœ¬æ¬Šåˆ©ï¼š</h4>
                <ul>
                    <li>ç”Ÿå‘½ã€è‡ªç”±å’Œäººèº«å®‰å…¨æ¬Š</li>
                    <li>å…å—å¥´å½¹å’Œé…·åˆ‘çš„æ¬Šåˆ©</li>
                    <li>æ³•å¾‹é¢å‰äººäººå¹³ç­‰</li>
                    <li>æ€æƒ³ã€è‰¯å¿ƒå’Œå®—æ•™è‡ªç”±</li>
                    <li>è¨€è«–å’Œæ„è¦‹è‡ªç”±</li>
                    <li>å’Œå¹³é›†æœƒå’Œçµç¤¾è‡ªç”±</li>
                    <li>å·¥ä½œå’Œæ•™è‚²æ¬Šåˆ©</li>
                    <li>é©ç•¶ç”Ÿæ´»æ°´æº–æ¬Š</li>
                    <li>åƒèˆ‡æ–‡åŒ–ç”Ÿæ´»æ¬Š</li>
                    <li>ç¤¾æœƒä¿éšœæ¬Š</li>
                </ul>
                <p style="margin-top: 15px; font-style: italic;">
                    "äººæ¬Šæ˜¯æ¯å€‹äººèˆ‡ç”Ÿä¿±ä¾†çš„æ¬Šåˆ©ï¼Œä¸åˆ†ç¨®æ—ã€æ€§åˆ¥ã€åœ‹ç±ã€æ°‘æ—ã€èªè¨€ã€å®—æ•™æˆ–ä»»ä½•å…¶ä»–èº«ä»½ã€‚"
                </p>
            </div>
            <button class="btn primary" onclick="closeModal('humanRightsModal')">äº†è§£äº†</button>
        </div>
    </div>

    <script>
        // éŠæˆ²ç‹€æ…‹
        let gameState = {
            humanityScore: 85,
            resourcePoints: 12,
            crisisCount: 3,
            turnNumber: 1,
            selectedRegion: null,
            selectedAction: null,
            maxTurns: 15
        };

        // åœ°å€è³‡æ–™
        const regions = [
            { id: 'asia', name: 'äºæ´²', status: 'threatened', issues: ['å‹å·¥æ¬Šç›Š', 'è¨€è«–è‡ªç”±'] },
            { id: 'europe', name: 'æ­æ´²', status: 'safe', issues: ['ç§»æ°‘æ¬Šåˆ©'] },
            { id: 'africa', name: 'éæ´²', status: 'crisis', issues: ['è²§å›°', 'æ•™è‚²æ¬Š'] },
            { id: 'namerica', name: 'åŒ—ç¾æ´²', status: 'safe', issues: ['ç¨®æ—å¹³ç­‰'] },
            { id: 'samerica', name: 'å—ç¾æ´²', status: 'recovering', issues: ['ç’°å¢ƒæ¬Šç›Š'] },
            { id: 'oceania', name: 'å¤§æ´‹æ´²', status: 'safe', issues: ['åŸä½æ°‘æ¬Šåˆ©'] }
        ];

        // è¡Œå‹•å¡ç‰‡
        const actionCards = [
            { id: 'education', name: 'æ•™è‚²å®£å°', cost: 2, effect: 5, description: 'æå‡äººæ¬Šæ„è­˜' },
            { id: 'legal', name: 'æ³•å¾‹æ´åŠ©', cost: 3, effect: 7, description: 'ä¿è­·å—å®³è€…' },
            { id: 'media', name: 'åª’é«”é—œæ³¨', cost: 2, effect: 4, description: 'åœ‹éš›æ–½å£“' },
            { id: 'humanitarian', name: 'äººé“æ•‘æ´', cost: 4, effect: 10, description: 'ç·Šæ€¥æ•‘åŠ©' },
            { id: 'policy', name: 'æ”¿ç­–å€¡è­°', cost: 5, effect: 12, description: 'åˆ¶åº¦æ”¹é©' }
        ];

        // åˆå§‹åŒ–éŠæˆ²
        function initGame() {
            createWorldMap();
            createActionCards();
            updateGameStats();
            generateRandomEvents();
        }

        // å‰µå»ºä¸–ç•Œåœ°åœ–
        function createWorldMap() {
            const mapContainer = document.getElementById('worldMap');
            mapContainer.innerHTML = '';
            
            regions.forEach(region => {
                const regionDiv = document.createElement('div');
                regionDiv.className = `region ${region.status}`;
                regionDiv.innerHTML = `
                    <strong>${region.name}</strong>
                    <small>${getStatusText(region.status)}</small>
                    ${region.status === 'crisis' ? '<div class="crisis-indicator"></div>' : ''}
                `;
                regionDiv.onclick = () => selectRegion(region.id);
                regionDiv.id = `region-${region.id}`;
                mapContainer.appendChild(regionDiv);
            });
        }

        // å‰µå»ºè¡Œå‹•å¡ç‰‡
        function createActionCards() {
            const cardsContainer = document.getElementById('actionCards');
            cardsContainer.innerHTML = '';
            
            actionCards.forEach(card => {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'action-card';
                cardDiv.innerHTML = `
                    <strong>${card.name}</strong>
                    <div style="font-size: 0.8em; margin-top: 5px;">${card.description}</div>
                    <div style="font-size: 0.8em; margin-top: 5px;">æˆæœ¬: ${card.cost} | æ•ˆæœ: +${card.effect}</div>
                `;
                cardDiv.onclick = () => selectAction(card.id);
                cardDiv.id = `action-${card.id}`;
                cardsContainer.appendChild(cardDiv);
            });
        }

        // é¸æ“‡åœ°å€
        function selectRegion(regionId) {
            // æ¸…é™¤ä¹‹å‰çš„é¸æ“‡
            document.querySelectorAll('.region').forEach(r => r.classList.remove('selected'));
            
            // é¸æ“‡æ–°åœ°å€
            document.getElementById(`region-${regionId}`).classList.add('selected');
            gameState.selectedRegion = regionId;
            
            updateExecuteButton();
            addEvent(`é¸æ“‡äº† ${regions.find(r => r.id === regionId).name} åœ°å€`);
        }

        // é¸æ“‡è¡Œå‹•
        function selectAction(actionId) {
            // æ¸…é™¤ä¹‹å‰çš„é¸æ“‡
            document.querySelectorAll('.action-card').forEach(c => c.classList.remove('selected'));
            
            // é¸æ“‡æ–°è¡Œå‹•
            document.getElementById(`action-${actionId}`).classList.add('selected');
            gameState.selectedAction = actionId;
            
            updateExecuteButton();
            addEvent(`é¸æ“‡äº† ${actionCards.find(a => a.id === actionId).name} è¡Œå‹•`);
        }

        // æ›´æ–°åŸ·è¡ŒæŒ‰éˆ•ç‹€æ…‹
        function updateExecuteButton() {
            const btn = document.getElementById('executeBtn');
            const canExecute = gameState.selectedRegion && gameState.selectedAction;
            const selectedAction = actionCards.find(a => a.id === gameState.selectedAction);
            const hasEnoughResources = selectedAction ? gameState.resourcePoints >= selectedAction.cost : false;
            
            btn.disabled = !canExecute || !hasEnoughResources;
            btn.textContent = canExecute && hasEnoughResources ? 'åŸ·è¡Œè¡Œå‹•' : 
                             canExecute ? 'è³‡æºä¸è¶³' : 'è«‹é¸æ“‡åœ°å€å’Œè¡Œå‹•';
        }

        // åŸ·è¡Œè¡Œå‹•
        function executeAction() {
            if (!gameState.selectedRegion || !gameState.selectedAction) return;
            
            const region = regions.find(r => r.id === gameState.selectedRegion);
            const action = actionCards.find(a => a.id === gameState.selectedAction);
            
            if (gameState.resourcePoints < action.cost) return;
            
            // æ¶ˆè€—è³‡æº
            gameState.resourcePoints -= action.cost;
            
            // æ‡‰ç”¨æ•ˆæœ
            let effectValue = action.effect;
            if (region.status === 'crisis') effectValue *= 1.5; // å±æ©Ÿåœ°å€æ•ˆæœåŠ å€
            
            gameState.humanityScore += effectValue;
            gameState.humanityScore = Math.min(100, gameState.humanityScore);
            
            // æ”¹å–„åœ°å€ç‹€æ³
            improveRegionStatus(region);
            
            // æ¸…é™¤é¸æ“‡
            clearSelections();
            
            // æ›´æ–°é¡¯ç¤º
            updateGameStats();
            addEvent(`åœ¨${region.name}åŸ·è¡Œ${action.name}ï¼Œäººé“æŒ‡æ•¸æå‡${effectValue}é»ï¼`);
            
            // æª¢æŸ¥å‹åˆ©æ¢ä»¶
            checkWinCondition();
        }

        // æ”¹å–„åœ°å€ç‹€æ³
        function improveRegionStatus(region) {
            const statusLevels = ['crisis', 'threatened', 'recovering', 'safe'];
            const currentIndex = statusLevels.indexOf(region.status);
            
            if (Math.random() < 0.6 && currentIndex < statusLevels.length - 1) {
                region.status = statusLevels[currentIndex + 1];
                createWorldMap(); // é‡æ–°ç¹ªè£½åœ°åœ–
                addEvent(`${region.name}çš„äººæ¬Šç‹€æ³æœ‰æ‰€æ”¹å–„ï¼`);
                
                if (region.status === 'safe') {
                    gameState.crisisCount = Math.max(0, gameState.crisisCount - 1);
                }
            }
        }

        // æ¸…é™¤é¸æ“‡
        function clearSelections() {
            gameState.selectedRegion = null;
            gameState.selectedAction = null;
            document.querySelectorAll('.region').forEach(r => r.classList.remove('selected'));
            document.querySelectorAll('.action-card').forEach(c => c.classList.remove('selected'));
            updateExecuteButton();
        }

        // ä¸‹ä¸€å›åˆ
        function nextTurn() {
            gameState.turnNumber++;
            gameState.resourcePoints = Math.min(15, gameState.resourcePoints + 3); // æ¯å›åˆç²å¾—è³‡æº
            
            // éš¨æ©Ÿäº‹ä»¶
            generateRandomEvents();
            
            // æ›´æ–°çµ±è¨ˆ
            updateGameStats();
            
            addEvent(`--- ç¬¬ ${gameState.turnNumber} å›åˆé–‹å§‹ ---`);
            
            // æª¢æŸ¥å¤±æ•—æ¢ä»¶
            if (gameState.turnNumber > gameState.maxTurns) {
                checkLoseCondition();
            }
        }

        // ç”Ÿæˆéš¨æ©Ÿäº‹ä»¶
        function generateRandomEvents() {
            const events = [
                { text: 'åœ‹éš›çµ„ç¹”æä¾›æ”¯æ´', effect: () => { gameState.resourcePoints += 2; } },
                { text: 'åª’é«”å ±å°å–šèµ·é—œæ³¨', effect: () => { gameState.humanityScore += 3; } },
                { text: 'æ–°çš„äººæ¬Šå±æ©Ÿå‡ºç¾', effect: () => { 
                    const safeRegions = regions.filter(r => r.status === 'safe');
                    if (safeRegions.length > 0) {
                        const randomRegion = safeRegions[Math.floor(Math.random() * safeRegions.length)];
                        randomRegion.status = 'threatened';
                        createWorldMap();
                    }
                }},
                { text: 'å¿—å·¥çµ„ç¹”åŠ å…¥è¡Œå‹•', effect: () => { gameState.resourcePoints += 1; } }
            ];
            
            if (Math.random() < 0.7) {
                const event = events[Math.floor(Math.random() * events.length)];
                event.effect();
                addEvent(`éš¨æ©Ÿäº‹ä»¶ï¼š${event.text}`);
            }
        }

        // æ›´æ–°éŠæˆ²çµ±è¨ˆ
        function updateGameStats() {
            document.getElementById('humanityScore').textContent = Math.round(gameState.humanityScore);
            document.getElementById('resourcePoints').textContent = gameState.resourcePoints;
            document.getElementById('crisisCount').textContent = regions.filter(r => r.status === 'crisis').length;
            document.getElementById('turnNumber').textContent = gameState.turnNumber;
            document.getElementById('progressBar').style.width = `${gameState.humanityScore}%`;
            
            updateExecuteButton();
        }

        // æ·»åŠ äº‹ä»¶è¨˜éŒ„
        function addEvent(text) {
            const eventLog = document.getElementById('eventLog');
            const eventItem = document.createElement('div');
            eventItem.className = 'event-item';
            eventItem.textContent = text;
            eventLog.insertBefore(eventItem, eventLog.firstChild);
            
            // é™åˆ¶è¨˜éŒ„æ•¸é‡
            if (eventLog.children.length > 10) {
                eventLog.removeChild(eventLog.lastChild);
            }
        }

        // ç²å–ç‹€æ³æ–‡å­—
        function getStatusText(status) {
            const statusMap = {
                'safe': 'å®‰å…¨',
                'threatened': 'å—å¨è„…',
                'crisis': 'å±æ©Ÿ',
                'recovering': 'æ¢å¾©ä¸­'
            };
            return statusMap[status] || status;
        }

        // æª¢æŸ¥å‹åˆ©æ¢ä»¶
        function checkWinCondition() {
            if (gameState.humanityScore >= 90) {
                setTimeout(() => {
                    alert('ğŸ‰ æ­å–œï¼æ‚¨æˆåŠŸæå‡äº†å…¨çƒäººæ¬Šç‹€æ³ï¼Œé”æˆäº†90%çš„äººé“æŒ‡æ•¸ï¼\n\næ‚¨æ˜¯çœŸæ­£çš„äººæ¬Šå®ˆè­·è€…ï¼');
                }, 500);
            }
        }

        // æª¢æŸ¥å¤±æ•—æ¢ä»¶
        function checkLoseCondition() {
            if (gameState.turnNumber > gameState.maxTurns && gameState.humanityScore < 90) {
                alert('ğŸ˜” éŠæˆ²çµæŸï¼åœ¨15å›åˆå…§æœªèƒ½é”æˆç›®æ¨™ã€‚\n\nä¸è¦ç°å¿ƒï¼Œäººæ¬Šä¿è­·æ˜¯ä¸€å€‹é•·æœŸçš„éç¨‹ï¼Œè®“æˆ‘å€‘é‡æ–°é–‹å§‹ï¼');
            }
        }

        // é‡æ–°é–‹å§‹éŠæˆ²
        function resetGame() {
            gameState = {
                humanityScore: 85,
                resourcePoints: 12,
                crisisCount: 3,
                turnNumber: 1,
                selectedRegion: null,
                selectedAction: null,
                maxTurns: 15
            };
            
            // é‡ç½®åœ°å€ç‹€æ³
            regions.forEach((region, index) => {
                const statuses = ['safe', 'threatened', 'crisis', 'safe', 'recovering', 'safe'];
                region.status = statuses[index];
            });
            
            document.getElementById('eventLog').innerHTML = '<div class="event-item">éŠæˆ²é‡æ–°é–‹å§‹ï¼ç›®æ¨™æ˜¯æå‡å…¨çƒäººæ¬Šç‹€æ³ã€‚</div>';
            
            clearSelections();
            createWorldMap();
            updateGameStats();
        }

        // é¡¯ç¤ºè¦å‰‡
        function showRules() {
            document.getElementById('rulesModal').classList.add('active');
        }

        // é¡¯ç¤ºäººæ¬ŠçŸ¥è­˜
        function showHumanRights() {
            document.getElementById('humanRightsModal').classList.add('active');
        }

        // é—œé–‰å½ˆçª—
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // é»æ“Šå½ˆçª—å¤–éƒ¨é—œé–‰
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });

        // åˆå§‹åŒ–éŠæˆ²
        initGame();
    </script>
</body>
</html>
